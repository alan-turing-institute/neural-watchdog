
[![License: MIT](https://img.shields.io/badge/License-MIT-green.svg)](https://github.com/alan-turing-institute/in-distribution-backdoors/blob/main/LICENSE)

<svg viewBox="222 585 1065 318" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" style="max-height: 500px" width="1065" height="318"><rect fill="#ffffff" height="1500" width="1500"/><g transform="matrix(0.6666666666666666,0,0,0.6666666666666666,249.39393939393938,665.5763048364632)"><svg width="1500" height="250" preserveAspectRatio="xMidYMid meet" data-background-color="#ffffff" viewBox="0 0 396 66" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><g transform="matrix(1,0,0,1,0.2400000000000091,0.4317832847605132)" id="tight-bounds"><svg width="395.52" height="65.1361775639544" viewBox="0 0 395.52 65.1361775639544"><g><svg width="395.52" height="65.1361775639544" viewBox="0 0 499.98311367108147 82.33967655506261"><g transform="matrix(1,0,0,1,104.4631136710814,17.741538581650744)"><svg width="395.52000000000004" height="46.85659939176112" viewBox="0 0 395.52000000000004 46.85659939176112"><g id="textblocktransform"><svg id="textblock" width="395.52000000000004" height="46.85659939176112" viewBox="0 0 395.52000000000004 46.85659939176112"><g><svg width="395.52000000000004" height="46.85659939176112" viewBox="0 0 395.52000000000004 46.85659939176112"><g transform="matrix(1,0,0,1,0,0)"><svg data-palette-color="#085f63" height="46.85659939176112" viewBox="4.45 -32.75 361.67 42.85" width="395.52000000000004"><path id="text-0" data-fill-palette-color="primary" class="wordmark-text-0" fill="#000000" transform="matrix(1,0,0,1,0,0)" opacity="1" d="M4.45-1.55L4.45-26.95 7.85-27.25Q8.05-25.7 8.2-23.6 8.35-21.5 8.43-19.28 8.5-17.05 8.5-15.05L8.5-15.05 8.5-0.1Q8.25 0 7.73 0.13 7.2 0.25 6.65 0.25L6.65 0.25Q5.55 0.25 5-0.18 4.45-0.6 4.45-1.55L4.45-1.55ZM28.55-28.85L28.55-3.45 25.1-3.15Q24.6-7.35 24.53-11.73 24.45-16.1 24.45-20.2L24.45-20.2 24.45-30.3Q24.75-30.4 25.25-30.53 25.75-30.65 26.35-30.65L26.35-30.65Q27.45-30.65 28-30.23 28.55-29.8 28.55-28.85L28.55-28.85ZM24.8-4L28.55-4.95 28.55-5.15 28.55-0.55Q28.1-0.2 27.4 0.05 26.7 0.3 25.85 0.3L25.85 0.3Q24.65 0.3 23.8-0.18 22.95-0.65 22.25-1.9L22.25-1.9 12.75-17.9Q12-19.25 11.1-20.88 10.2-22.5 9.4-23.98 8.6-25.45 8.15-26.4L8.15-26.4 4.45-25.45 4.45-29.8Q4.85-30.2 5.58-30.45 6.3-30.7 7.15-30.7L7.15-30.7Q8.35-30.7 9.2-30.23 10.05-29.75 10.75-28.5L10.75-28.5 20.3-12.5Q21.1-11.15 21.98-9.53 22.85-7.9 23.6-6.43 24.35-4.95 24.8-4L24.8-4ZM55-11.35L38.2-9 38-12.15 53.1-14.2Q52.9-16.95 51.2-18.73 49.5-20.5 46.5-20.5L46.5-20.5Q43.4-20.5 41.37-18.28 39.35-16.05 39.35-11.9L39.35-11.9 39.35-10.8Q39.7-6.8 41.97-4.73 44.25-2.65 48.2-2.65L48.2-2.65Q50.3-2.65 52-3.35 53.7-4.05 54.7-4.85L54.7-4.85Q55.25-4.5 55.57-4.03 55.9-3.55 55.9-2.95L55.9-2.95Q55.9-2 54.82-1.18 53.75-0.35 51.97 0.15 50.2 0.65 48 0.65L48 0.65Q44.15 0.65 41.32-0.75 38.5-2.15 36.97-4.93 35.45-7.7 35.45-11.7L35.45-11.7Q35.45-14.55 36.27-16.78 37.1-19 38.57-20.55 40.05-22.1 42.1-22.93 44.15-23.75 46.55-23.75L46.55-23.75Q49.6-23.75 51.92-22.45 54.25-21.15 55.57-18.82 56.9-16.5 56.9-13.5L56.9-13.5Q56.9-12.4 56.4-11.93 55.9-11.45 55-11.35L55-11.35ZM62.7-8.45L62.7-8.45 62.7-13 66.7-13 66.7-8.65Q66.7-5.45 68.4-4.05 70.1-2.65 73.1-2.65L73.1-2.65Q75.1-2.65 76.5-3.08 77.9-3.5 78.7-3.95L78.7-3.95 78.7-13 82.7-13 82.7-4.1Q82.7-3.05 82.42-2.43 82.15-1.8 81.1-1.2L81.1-1.2Q80-0.55 77.95 0.05 75.9 0.65 73.05 0.65L73.05 0.65Q69.75 0.65 67.42-0.33 65.1-1.3 63.9-3.33 62.7-5.35 62.7-8.45ZM82.7-21.5L82.7-10.4 78.7-10.4 78.7-23Q78.95-23.1 79.47-23.23 80-23.35 80.55-23.35L80.55-23.35Q81.65-23.35 82.17-22.93 82.7-22.5 82.7-21.5L82.7-21.5ZM66.7-21.5L66.7-10.4 62.7-10.4 62.7-23Q62.95-23.1 63.47-23.23 64-23.35 64.6-23.35L64.6-23.35Q65.65-23.35 66.17-22.93 66.7-22.5 66.7-21.5L66.7-21.5ZM94.19-18.8L94.19-18.8 94.19-10.9 90.19-10.9 90.19-18.5Q90.19-19.65 90.62-20.33 91.04-21 92.04-21.65L92.04-21.65Q93.34-22.5 95.59-23.13 97.84-23.75 100.59-23.75L100.59-23.75Q104.59-23.75 104.59-21.75L104.59-21.75Q104.59-21.25 104.44-20.83 104.29-20.4 104.04-20.1L104.04-20.1Q103.54-20.2 102.74-20.3 101.94-20.4 101.14-20.4L101.14-20.4Q98.84-20.4 97.09-19.93 95.34-19.45 94.19-18.8ZM90.19-1.55L90.19-13.2 94.19-12.6 94.19-0.1Q93.94 0 93.44 0.13 92.94 0.25 92.34 0.25L92.34 0.25Q91.29 0.25 90.74-0.18 90.19-0.6 90.19-1.55L90.19-1.55ZM117.54-2.6L117.54-2.6 117.54-2.6Q119.64-2.6 121.02-3.03 122.39-3.45 122.99-3.85L122.99-3.85 122.99-11.1 116.79-10.45Q114.19-10.25 112.94-9.3 111.69-8.35 111.69-6.55L111.69-6.55Q111.69-4.7 113.17-3.65 114.64-2.6 117.54-2.6ZM117.49-23.75L117.49-23.75 117.49-23.75Q121.84-23.75 124.39-21.8 126.94-19.85 126.94-15.65L126.94-15.65 126.94-3.8Q126.94-2.7 126.52-2.13 126.09-1.55 125.24-1.05L125.24-1.05Q124.04-0.4 122.04 0.15 120.04 0.7 117.54 0.7L117.54 0.7Q112.84 0.7 110.27-1.15 107.69-3 107.69-6.5L107.69-6.5Q107.69-9.75 109.87-11.48 112.04-13.2 115.89-13.55L115.89-13.55 122.99-14.25 122.99-15.65Q122.99-18.15 121.49-19.3 119.99-20.45 117.44-20.45L117.44-20.45Q115.39-20.45 113.52-19.85 111.64-19.25 110.19-18.5L110.19-18.5Q109.79-18.85 109.47-19.33 109.14-19.8 109.14-20.3L109.14-20.3Q109.14-21.6 110.59-22.3L110.59-22.3Q111.94-23 113.72-23.38 115.49-23.75 117.49-23.75ZM134.64-1.55L134.64-13.2 138.64-12.6 138.64-0.1Q138.39 0 137.89 0.13 137.39 0.25 136.79 0.25L136.79 0.25Q135.74 0.25 135.19-0.18 134.64-0.6 134.64-1.55L134.64-1.55ZM138.64-30.95L138.64-10.7 134.64-11.25 134.64-32.4Q134.89-32.5 135.41-32.63 135.94-32.75 136.49-32.75L136.49-32.75Q137.59-32.75 138.11-32.33 138.64-31.9 138.64-30.95L138.64-30.95ZM170.73-22.85L170.73-22.85 170.73-22.85Q171.13-23.05 171.73-23.2 172.33-23.35 172.98-23.35L172.98-23.35Q173.98-23.35 174.66-23.03 175.33-22.7 175.53-22.05L175.53-22.05Q176.78-18.45 177.81-15.38 178.83-12.3 179.76-9.43 180.68-6.55 181.63-3.5L181.63-3.5 181.83-3.5Q182.78-8 183.68-12.28 184.58-16.55 185.43-20.95 186.28-25.35 186.98-30.35L186.98-30.35Q187.68-30.7 188.68-30.7L188.68-30.7Q189.63-30.7 190.18-30.28 190.73-29.85 190.73-29L190.73-29Q190.73-28.05 190.46-26.13 190.18-24.2 189.71-21.63 189.23-19.05 188.61-16.18 187.98-13.3 187.28-10.43 186.58-7.55 185.88-5 185.18-2.45 184.53-0.55L184.53-0.55Q184.08-0.3 183.38-0.08 182.68 0.15 181.78 0.15L181.78 0.15Q180.68 0.15 179.93-0.2 179.18-0.55 178.93-1.15L178.93-1.15Q178.23-2.9 177.23-5.78 176.23-8.65 175.16-12.08 174.08-15.5 173.08-18.85L173.08-18.85Q172.13-15.55 171.03-12 169.93-8.45 168.91-5.4 167.88-2.35 167.08-0.5L167.08-0.5Q166.73-0.3 166.01-0.08 165.28 0.15 164.38 0.15L164.38 0.15Q163.28 0.15 162.56-0.23 161.83-0.6 161.58-1.15L161.58-1.15Q161.08-2.4 160.36-4.9 159.63-7.4 158.83-10.63 158.03-13.85 157.26-17.32 156.48-20.8 155.81-24.03 155.13-27.25 154.73-29.75L154.73-29.75Q155.08-30.1 155.68-30.4 156.28-30.7 156.98-30.7L156.98-30.7Q157.88-30.7 158.38-30.28 158.88-29.85 159.08-28.85L159.08-28.85Q159.73-25.7 160.33-22.75 160.93-19.8 161.56-16.8 162.18-13.8 162.88-10.53 163.58-7.25 164.43-3.5L164.43-3.5 164.63-3.5Q165.33-5.75 165.98-7.8 166.63-9.85 167.33-12.03 168.03-14.2 168.86-16.8 169.68-19.4 170.73-22.85ZM204.93-2.6L204.93-2.6 204.93-2.6Q207.03-2.6 208.41-3.03 209.78-3.45 210.38-3.85L210.38-3.85 210.38-11.1 204.18-10.45Q201.58-10.25 200.33-9.3 199.08-8.35 199.08-6.55L199.08-6.55Q199.08-4.7 200.56-3.65 202.03-2.6 204.93-2.6ZM204.88-23.75L204.88-23.75 204.88-23.75Q209.23-23.75 211.78-21.8 214.33-19.85 214.33-15.65L214.33-15.65 214.33-3.8Q214.33-2.7 213.91-2.13 213.48-1.55 212.63-1.05L212.63-1.05Q211.43-0.4 209.43 0.15 207.43 0.7 204.93 0.7L204.93 0.7Q200.23 0.7 197.66-1.15 195.08-3 195.08-6.5L195.08-6.5Q195.08-9.75 197.26-11.48 199.43-13.2 203.28-13.55L203.28-13.55 210.38-14.25 210.38-15.65Q210.38-18.15 208.88-19.3 207.38-20.45 204.83-20.45L204.83-20.45Q202.78-20.45 200.91-19.85 199.03-19.25 197.58-18.5L197.58-18.5Q197.18-18.85 196.86-19.33 196.53-19.8 196.53-20.3L196.53-20.3Q196.53-21.6 197.98-22.3L197.98-22.3Q199.33-23 201.11-23.38 202.88-23.75 204.88-23.75ZM221.68-6.05L221.68-13.2 225.68-13.2 225.68-6.3Q225.68-4.3 226.83-3.48 227.98-2.65 229.98-2.65L229.98-2.65Q230.83-2.65 231.88-2.95 232.93-3.25 233.63-3.65L233.63-3.65Q233.93-3.35 234.18-2.9 234.43-2.45 234.43-1.85L234.43-1.85Q234.43-0.75 233.13-0.05 231.83 0.65 229.53 0.65L229.53 0.65Q226.03 0.65 223.85-0.9 221.68-2.45 221.68-6.05L221.68-6.05ZM232.83-19.3L223.73-19.3 223.73-22.6 233.88-22.6Q234.03-22.4 234.18-21.95 234.33-21.5 234.33-21L234.33-21Q234.33-20.2 233.93-19.75 233.53-19.3 232.83-19.3L232.83-19.3ZM225.68-28.35L225.68-11.7 221.68-11.7 221.68-29.8Q221.93-29.9 222.45-30.03 222.98-30.15 223.58-30.15L223.58-30.15Q224.63-30.15 225.15-29.73 225.68-29.3 225.68-28.35L225.68-28.35ZM250.93-20.4L250.93-20.4 250.93-20.4Q247.53-20.4 245.28-18.1 243.03-15.8 243.03-11.5L243.03-11.5Q243.03-7.25 245.2-4.95 247.38-2.65 250.93-2.65L250.93-2.65Q253.03-2.65 254.43-3.23 255.83-3.8 256.93-4.55L256.93-4.55Q257.48-4.25 257.83-3.8 258.18-3.35 258.18-2.7L258.18-2.7Q258.18-1.3 256.1-0.33 254.03 0.65 250.93 0.65L250.93 0.65Q247.48 0.65 244.75-0.68 242.03-2 240.48-4.7 238.93-7.4 238.93-11.5L238.93-11.5Q238.93-15.55 240.53-18.28 242.13-21 244.85-22.38 247.58-23.75 250.83-23.75L250.83-23.75Q253.93-23.75 255.95-22.7 257.98-21.65 257.98-20.3L257.98-20.3Q257.98-19.7 257.63-19.25 257.28-18.8 256.73-18.55L256.73-18.55Q255.63-19.3 254.3-19.85 252.98-20.4 250.93-20.4ZM284.17-14.65L284.17-9.95 280.17-9.95 280.17-14.55Q280.17-17.55 278.5-19 276.82-20.45 274.17-20.45L274.17-20.45Q272.22-20.45 270.55-19.7 268.87-18.95 267.72-17.9L267.72-17.9 266.97-21.15Q268.17-22 270.15-22.88 272.12-23.75 274.72-23.75L274.72-23.75Q278.87-23.75 281.52-21.5 284.17-19.25 284.17-14.65L284.17-14.65ZM264.22-1.55L264.22-13.2 268.22-13.2 268.22-0.1Q267.97 0 267.47 0.13 266.97 0.25 266.37 0.25L266.37 0.25Q265.32 0.25 264.77-0.18 264.22-0.6 264.22-1.55L264.22-1.55ZM280.17-1.55L280.17-13.15 284.17-13.1 284.17-0.1Q283.92 0 283.4 0.13 282.87 0.25 282.32 0.25L282.32 0.25Q281.22 0.25 280.7-0.18 280.17-0.6 280.17-1.55L280.17-1.55ZM268.22-30.95L268.22-11.25 264.22-11.25 264.22-32.4Q264.47-32.5 265-32.63 265.52-32.75 266.12-32.75L266.12-32.75Q267.17-32.75 267.7-32.33 268.22-31.9 268.22-30.95L268.22-30.95ZM307.42-3.95L307.42-3.95 307.42-20.75 311.42-20.8 311.42-3.8Q311.42-2.85 311-2.27 310.57-1.7 309.67-1.15L309.67-1.15Q308.67-0.5 306.82 0.08 304.97 0.65 302.57 0.65L302.57 0.65Q298.97 0.65 296.22-0.6 293.47-1.85 291.92-4.53 290.37-7.2 290.37-11.45L290.37-11.45Q290.37-15.8 291.9-18.5 293.42-21.2 296.02-22.48 298.62-23.75 301.72-23.75L301.72-23.75Q303.67-23.75 305.42-23.2 307.17-22.65 308.17-21.85L308.17-21.85 308.17-18.15Q307.22-19.1 305.7-19.78 304.17-20.45 302.12-20.45L302.12-20.45Q300.07-20.45 298.32-19.58 296.57-18.7 295.52-16.7 294.47-14.7 294.47-11.35L294.47-11.35Q294.47-6.8 296.67-4.73 298.87-2.65 302.52-2.65L302.52-2.65Q304.27-2.65 305.4-3.03 306.52-3.4 307.42-3.95ZM311.42-30.95L311.42-19.8 307.42-19.75 307.42-32.4Q307.67-32.5 308.2-32.63 308.72-32.75 309.27-32.75L309.27-32.75Q310.37-32.75 310.9-32.33 311.42-31.9 311.42-30.95L311.42-30.95ZM340.47-11.55L340.47-11.55 340.47-11.55Q340.47-7.85 339.07-5.1 337.67-2.35 335.12-0.85 332.57 0.65 329.12 0.65L329.12 0.65Q325.67 0.65 323.09-0.85 320.52-2.35 319.12-5.1 317.72-7.85 317.72-11.55L317.72-11.55Q317.72-15.3 319.14-18.03 320.57-20.75 323.14-22.25 325.72-23.75 329.12-23.75L329.12-23.75Q332.52-23.75 335.07-22.25 337.62-20.75 339.04-18.03 340.47-15.3 340.47-11.55ZM329.12-20.45L329.12-20.45 329.12-20.45Q325.77-20.45 323.79-18.07 321.82-15.7 321.82-11.55L321.82-11.55Q321.82-7.35 323.74-5 325.67-2.65 329.12-2.65L329.12-2.65Q332.52-2.65 334.44-5.03 336.37-7.4 336.37-11.55L336.37-11.55Q336.37-15.7 334.44-18.07 332.52-20.45 329.12-20.45ZM356.27-0.7L356.27-0.7 356.27-0.7Q353.37-0.7 350.92-1.83 348.47-2.95 346.97-5.5 345.47-8.05 345.47-12.25L345.47-12.25Q345.47-16.05 346.94-18.6 348.42-21.15 351.02-22.45 353.62-23.75 356.97-23.75L356.97-23.75Q359.27-23.75 361.19-23.18 363.12-22.6 364.42-21.75L364.42-21.75Q365.17-21.25 365.64-20.63 366.12-20 366.12-19.1L366.12-19.1 366.12-3.65 362.12-3.65 362.12-19.05Q361.27-19.6 359.99-20.03 358.72-20.45 356.97-20.45L356.97-20.45Q353.62-20.45 351.57-18.4 349.52-16.35 349.52-12.3L349.52-12.3Q349.52-7.8 351.59-5.9 353.67-4 356.72-4L356.72-4Q358.92-4 360.27-4.75 361.62-5.5 362.42-6.4L362.42-6.4 362.62-2.85Q361.87-2.05 360.24-1.38 358.62-0.7 356.27-0.7ZM362.12 0.75L362.12 0.75 362.12-4.5 366.12-4.5 366.12 1Q366.12 4.3 364.69 6.3 363.27 8.3 360.79 9.2 358.32 10.1 355.22 10.1L355.22 10.1Q352.72 10.1 350.92 9.55 349.12 9 348.47 8.65L348.47 8.65Q346.97 7.8 346.97 6.5L346.97 6.5Q346.97 5.8 347.29 5.33 347.62 4.85 348.12 4.6L348.12 4.6Q349.17 5.4 351.09 6.08 353.02 6.75 355.22 6.75L355.22 6.75Q358.57 6.75 360.34 5.3 362.12 3.85 362.12 0.75Z"/></svg></g></svg></g></svg></g></svg></g><g><svg width="82.33967655506261" height="82.33967655506261" viewBox="0 0 82.33967655506261 82.33967655506261"><g><svg/></g><g id="icon-0"><svg width="82.33967655506261" height="82.33967655506261" viewBox="0 0 82.33967655506261 82.33967655506261"><g><path stroke="transparent" fill="#000000" data-fill-palette-color="accent" d="M0 41.17c0-22.737 18.432-41.17 41.17-41.17 22.737 0 41.17 18.432 41.17 41.17 0 22.737-18.432 41.17-41.17 41.17-22.737 0-41.17-18.432-41.17-41.17zM41.17 78.114c20.404 0 36.944-16.541 36.944-36.944 0-20.404-16.541-36.944-36.944-36.944-20.404 0-36.944 16.541-36.944 36.944 0 20.404 16.541 36.944 36.944 36.944z"/><ellipse data-fill-palette-color="accent" fill-opacity="1" stroke-width="0" stroke="transparent" fill="#000000" cy="41.169838277531305" cx="41.169838277531305" ry="40.75813989475599" rx="40.75813989475599"/></g><g transform="matrix(1,0,0,1,18.21235393138142,24.81974750104682)"><svg width="45.91496869229977" height="32.70018155296897" viewBox="0 0 45.91496869229977 32.70018155296897"><g><svg id="dxe-0" data-fill-palette-color="quaternary" class="icon-dxe-0" width="45.91496869229977" height="32.70018155296897" xml:space="preserve" viewBox="0 14.391 100 71.219" y="0" x="0" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><path data-fill-palette-color="quaternary" fill="#ffffff" d="M100 27.126S96.039 31.636 82.063 41.668C70.611 49.887 56.175 48.205 41.826 40.456 36.005 37.312 33.696 35.366 31.022 31.289 28.43 27.336 22.548 14.391 22.548 14.391S21.037 19.873 10.925 29.753C8.864 31.767 0 37.541 0 37.541L6.31 43.807S18.034 38.537 24.464 43.67C27.878 46.394 29.516 49.318 29.793 61.233 30.069 73.143 30.068 85.61 30.068 85.61H38.694L42.296 67.525S48.249 71.496 56.014 70.759C65.851 69.827 74.393 66.359 74.393 66.359S75.755 69.845 75.755 85.61H85.66S85.012 58.31 89.942 46.965C93.195 39.479 100 27.126 100 27.126"/></svg></g></svg></g></svg></g></svg></g></svg></g><defs/></svg><rect visibility="hidden" stroke="none" fill="none" height="65.1361775639544" width="395.52"/></g></svg></g></svg>
![logo-black-bh](https://github.com/user-attachments/assets/9e42bcc5-717f-4816-9c01-fdce84f53367)

**Neural Watchdog** is an open-source tool designed to detect stealthy backdoor attacks in Deep Reinforcement Learning (DRL) policies. In this repository, we introduce an evasive backdoor technique called the "in-distribution trigger" and demonstrate how to detect them using our tool.

For a detailed understanding of the technical aspects of Neural Watchdog, please refer to our paper:
https://arxiv.org/abs/2407.15168

If you would like to cite our work, please use the following reference:
```
@inproceedings{vyas2024mitigating,
  title={Mitigating Deep Reinforcement Learning Backdoors in the Neural Activation Space},
  author={Vyas, Sanyam and Hicks, Chris and Mavroudis, Vasilios},
  booktitle={2024 IEEE Security and Privacy Workshops (SPW)},
  pages={76--86},
  year={2024},
  organization={IEEE}
}
```

### Getting Started

Before you begin, ensure that you have Conda installed on your Mac. If you do not have Conda installed, please follow the [official Conda installation guide for a Mac](https://docs.conda.io/projects/conda/en/latest/user-guide/install/macos.html). 

#### Installation 

Clone the Repository
```
git clone git@github.com:alan-turing-institute/in-distribution-backdoors.git
```
Create the conda environment
```python
conda env create -f environment.yml
conda activate minigrid_farama_2
```
Set PYTHONPATH
```python
export PYTHONPATH= "/path/to/file/Minigrid"
echo $PYTHONPATH
```

#### Execution

Run the visualize file, and edit the "visualize.py" file and "crossings.py" code according to the data you want to collect (Non-triggered/Triggered, Goal in field of view, Trigger in field of view, Thresholding Detector Algorithm)(Trigger on/Non-Trigger off). The visualisation file collects the neural activations for every step and saves them to a file according to the type of data that requires collection,
```python
python3 -m scripts.visualize --env MiniGrid-LavaCrossingS9N1-v0 --model DSLP_Crossings_Trigger_60k_256_neurons --episodes 1000
```

To run the training file from scratch, and edit the "visualize.py" file and "crossings.py" code according to the data you want to collect (Non-triggered/Triggered, Goal in field of view, Trigger in field of view, Thresholding Detector Algorithm)(Trigger on/Non-Trigger off). The train.py file will save all model outputs to the ```Minigrid/minigrid/torch-ac/rl-starter-files/storage``` folder. This model can then be accessed in the visualize.py file above 
```python
python3 -m scripts.train --algo ppo --env MiniGrid-LavaCrossingS9N1-v0  --model model_name --save-interval 10 --frames 60000000
```

### Atari Breakout Experiments

This repository contains the source code of sanitization backdoor policies for Atari breakout game environment. The backdoor policy in this example has been trained using the environment poisoning framework of TrojDRL [paper](https://arxiv.org/pdf/1903.06638.pdf) .

The state space consists of a concatenated image frames. The trigger is a 3x5 image inserted on the tile space of the Atari Breakout Game. The backdoor policy has been trained to a level so that in absense of trigger the policy consistently achieves high score against the oppenent while in presence of trigger it takes 'no move' action eventually achieving a very low score on average.


#### Setup codebase and python environment.

1. install anaconda, follow instructions [here](https://docs.anaconda.com/anaconda/install/).
2. create a new environment from the specification file.
 ```conda env create --name NEW_ENV_NAME -f environment.yml```
3. activate conda environment.
 ```conda activate NEW_ENV_NAME```

#### Run the code. 
1. test backdoor policy in the clean environment :  
	 ```python driver_parallel.py 'backdoor_in_clean' 'save_states'```
	- change number of trials, number of test episodes(test_count) in the trials if needed.
	- the clean states data generated here would be used for sanitization in step 3.
2. test backdoor policy in the triggered environment :  
	 ```python driver_parallel.py 'backdoor_in_triggered'```
3. sanitize backdoor and test sanitized policy in the triggered environment :  
	```python driver_parallel.py 'sanitized_in_triggered'```
	- construct sanitized policies for various number of clean sample sets and then test it.
4. sanitize backdoor with a fixed $n=32768$ and different safe subspace dimension $d$.
     ```python driver_parallel.py 'sanitized_with_fixed_n'```
	- to run this part, we need to have bases for $n=32768$ samples obtained from step 3. 



#### Training the backdoor policy from scratch.
- We train a strongly targeted backdoor policy that uses a  and takes 'no move' action when the trigger is active as specfied in the TrojDRL paper. For more details please refer to this paper and the code.
- To train this backdoor policy run :
```
python3 train.py --game=breakout --debugging_folder=pretrained_backdoor/strong_targeted/breakout_target_noop/ --poison --color=5 --attack_method=strong_targeted --pixels_to_poison_h=5 --pixels_to_poison_v=3 --start_position="29,28" --when_to_poison="uniformly" --action=2 --budget=20000 --device='/cpu:0' --emulator_counts=12 --emulator_workers=4
```
#### Results

Our results show that our in-distribution trigger successfully evades the defence algorihtm of Bharti et al's NeurIPS solution [paper](https://openreview.net/forum?id=11WmFbrIt26)

[performance_breakout.pdf](https://github.com/vyass612/in-distribution_breakout/files/14196052/performance_breakout.pdf)

[spectrum_safe_subspace.pdf](https://github.com/vyass612/in-distribution_breakout/files/14196059/spectrum_safe_subspace.pdf)


#### Edited Files 

The ```evaluator.py ``` file contains the code which changes the size of the trigger along with the ```params_indist.yml``` file. The latter file adjusts the default size along with the colour of the trigger
The ```plot_graphs.py``` file saves the visualisation found in figure 2 of the paper, whilst the ```analyse_performance_for_n=32768_sanitization.py``` file saves the visualisation found in figure 3 of the paper


